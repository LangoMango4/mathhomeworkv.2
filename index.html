<script>
/* ... previous code ... */
function adminSendNotification() {
  if (!isAdmin) return;
  const msg = (document.getElementById("notifMsgInput").value || "").trim();
  if (!msg) return alert("Notification message required.");
  const target = document.getElementById("notifTarget").value;
  let pins = [];
  if (target === "pins") {
    const rawPins = (document.getElementById("notifPins").value || "").split(",");
    pins = rawPins.map(p=>p.trim()).filter(Boolean);
    if (!pins.length) return alert("Enter at least one PIN.");
  }
  // For unique notification id (timestamp+random)
  const notif = {
    id: "notif_" + Date.now() + "_" + Math.floor(Math.random()*100000),
    msg: msg,
    target: target,
    pins: pins,
    ts: Date.now(),
    by: "admin"
  };
  // Write to localStorage (triggers all tabs, except this one)
  try { localStorage.setItem(LS_NOTIF, JSON.stringify(notif)); } catch(e){}
  // Try to sync to cloud if ready
  cloudSetNotif(notif);
  // Always show to self if the logic matches (even if it's not just "everyone"/"me"/pins)
  if (shouldShowNotification(notif)) showNotification(notif.msg, notif.id);
}
/* ... rest of code ... */
</script>
